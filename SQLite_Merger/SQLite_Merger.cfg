{
  "_help_0": "-------------------------------------------------------------------",
  "_help_1": "Attention le backslash est le caractère d'échappement pour les json",
  "_help_2": "-------------------------------------------------------------------",
  "base": {
    "sqlite_template_name": "SQLite_Merger_DB_Template.sqlite",
    "input_codec": "cp1252",
    "disable_output": false,
    "keep_db": true,
    "kept_db_name": "Database_{periode}_{phase}_{timestamp}.sqlite",
    "copy_csv_to_temp": true
  },
  "sql_variables": [
      {
        "sql_name": "Phase",
        "sql_table": "Variables",
        "sql_set_col": "VALEUR",
        "sql_where_col": "VARIABLE",
        "level":"advanced",
        "default": "C"
      },
      {
        "sql_name": "Periode",
        "ui_label": "Période (AAAA.MM)",
        "sql_table": "Variables",
        "sql_set_col": "VALEUR",
        "sql_where_col": "VARIABLE",
        "level":"user",
        "default": "=format_date(offset_day(now(), -28), '%Y.%m')",
        "regex_ctrl": "^(20)\\d{2}\\.(0[1-9]|1[0-2])$"
      },
      {
        "sql_name": "Source_For_PCG_Pattern",
        "sql_table": "Variables",
        "sql_set_col": "VALEUR",
        "sql_where_col": "VARIABLE",
        "level":"internal",
        "default": "ZBALBFC%"
      }
  ],
  "sql_tables": [
      {
        "table_id": "FACT_BALANCES",
        "type": "FACT",
        "sql_name": "Fact_Data",
        "csv_source": "01-Données Extract X3",
        "csv_pattern_regex": "^ZBAL.*\\.(csv|txt)$",
        "col_source": "SOURCE",
        "required_cols": ["SOCIETE", "COMPTE", "MONTANT"]
      },
      {
        "table_id": "DIM_TO_PCG_GRP",
        "type": "DIM",
        "sql_name": "Dim_Cptes_Transco",
        "excel_name": "Tbl_To_PCG_GRP",
        "csv_name": "To_PCG_GRP.csv"
      },
      {
        "table_id": "DIM_COMPTES",
        "type": "DIM",
        "sql_name": "Dim_Comptes",
        "excel_name": "Tbl_Cptes_Dédiés",
        "csv_name": "Cptes.csv"
      },
      {
        "table_id": "DIM_IGNORE",
        "type": "DIM",
        "sql_name": "Dim_Ignore",
        "excel_name": "Tbl_Ignore",
        "csv_name": "Ignore.csv"
      },
      {
        "table_id": "DIM_GRP_ACTIV",
        "type": "DIM",
        "sql_name": "Dim_Grp_Activ",
        "excel_name": "Dim_Grp_par_Activ",
        "csv_name": "Grp_Activ.csv"
      },
      {
        "table_id": "DIM_GRP_STES",
        "type": "DIM",
        "sql_name": "Dim_Grp_Stes",
        "excel_name": "Dim_Grp_par_Stes",
        "csv_name": "Grp_Stes.csv"
      },
      {
        "table_id": "FACT_AJUST",
        "type": "FACT",
        "sql_name": "Fact_Data",
        "excel_name": "Tbl_Ajust_Bal",
        "csv_name": "Ajust_Bal.csv",
        "col_source": "SOURCE",
        "required_cols": ["SOCIETE", "COMPTE", "MONTANT"]
      },
      {
        "table_id": "VIEW_BALANCES",
        "type": "OUTPUT",
        "sql_name": "View_Export_Balance_Conso",
        "csv_name": "Bal_{periode}_FIM_{phase}_{timestamp}.csv"
      },
      {
        "table_id": "VIEW_ALERTES",
        "type": "OUTPUT",
        "sql_name": "View_Export_Alertes",
        "csv_name": "Bal_{periode}_ALERTES_{phase}_{timestamp}.csv"
      }
  ],
  "sql_commands": [
    {"phase": "init", "sql": "UPDATE Commandes SET Trigger_With_1 = 1 WHERE Commande = 'Clear_All';", "commit": true},
    {"phase": "init", "sql": "VACUUM;", "commit": true},
    {"phase": "post_imports", "sql": "CREATE INDEX IF NOT EXISTS idx_Fact_Data_1 ON Fact_Data (COMPTE);", "commit": false},
    {"phase": "post_imports", "sql": "CREATE INDEX IF NOT EXISTS idx_Fact_Data_2 ON Fact_Data (INTERCO);", "commit": false},
    {"phase": "post_imports", "sql": "CREATE INDEX IF NOT EXISTS idx_Fact_Data_3 ON Fact_Data (SOCIETE);", "commit": false},
    {"phase": "post_imports", "sql": "CREATE INDEX IF NOT EXISTS idx_Dim_Cptes_Transco ON Dim_Cptes_Transco (COMPTE_LOCAL);", "commit": false},
    {"phase": "post_imports", "sql": "UPDATE Commandes SET Trigger_With_1 = 1 WHERE Commande = 'Update_Fact_Data_Interco_Tiers';", "commit": false},
    {"phase": "post_imports", "sql": "UPDATE Commandes SET Trigger_With_1 = 1 WHERE Commande = 'Update_Dim_Tables';", "commit": false},
    {"phase": "post_imports", "sql": "UPDATE Commandes SET Trigger_With_1 = 1 WHERE Commande = 'Sanitize_Dim';", "commit": false},
    {"phase": "post_imports", "sql": "UPDATE Commandes SET Trigger_With_1 = 1 WHERE Commande = 'Calc_Cptes_Transco';", "commit": false},
    {"phase": "post_imports", "sql": "UPDATE Commandes SET Trigger_With_1 = 1 WHERE Commande = 'Calc_Ignore';", "commit": false}
  ],
  "not_optimized": [
      {"sql": "index optimisé / mais base plus lourde (env +16 mo) et pas de réel gain de temps à l'execution", "commit": false},
      {"sql": "CREATE INDEX IF NOT EXISTS idx_Fact_Data_1 ON Fact_Data (SOCIETE, COMPTE, INTERCO, SOURCE);", "commit": false},
      {"sql": "CREATE INDEX IF NOT EXISTS idx_Fact_Data_2 ON Fact_Data (COMPTE);", "commit": false},
      {"sql": "CREATE INDEX IF NOT EXISTS idx_Fact_Data_3 ON Fact_Data (INTERCO, SOURCE);", "commit": false},
      {"sql": "CREATE INDEX IF NOT EXISTS idx_Dim_Cptes_Transco ON Dim_Cptes_Transco (COMPTE_LOCAL);", "commit": false}
  ]
}
